%$Id$

\subsection{Configuration sous Linux}

\subsubsection{Configuration IP}
Quelle que soit ta distribution, il faut que tu décides d'un nom de machine --- ton pseudo en général, pour que l'on puisse facilement te 'tchatter' ou aller sur ton FTP. Tu as également besoin de connaître ton adresse IP. L'explication de comment la calculer de trouve page \pageref{calcul_ip} et notée dorénavant 129.104.AAA.BBB.

Bien sûr, l'ensemble des manipulations doit se faire en tant que root.

\paragraph{Sous Gentoo}

Si tu n'as jamais fait de configuration réseau sur ta Gentoo, il faudra certainement créer les fichiers qui suivent.

Le fichier \file{/etc/hostname} contient ton nom de machine. Tu peux éditer \file{/etc/hostname} avec ton éditeur préféré (vi ou vim, pico, voire emacs si tu aimes), mais la commande ci-dessous est suffisante:

\cmdline{echo 'ton\_pseudo' > /etc/hostname}

Le fichier \file{/etc/resolv.conf} décrit comment résoudre les noms DNS. La première ligne donne les suffixes à utiliser par défaut, et la seconde ligne indique les serveurs de noms, ceux qui associent le nom \server{frankiz} ou \server{ton\_pseudo} aux IP '129.104.201.51' ou 'ton\_ip' Le fichier contient donc :

\cmdline{search eleves.polytechnique.fr polytechnique.fr\\
nameserver 129.104.201.52 129.104.201.51}

Enfin, le fichier \file{/etc/conf.d/net} contient la description de l'interface réseau et les informations de routage. Il indique ton IP, ton sous-réseau (ton étage), et la passerelle pour sortir de ton étage:

\cmdline{iface\_eth0="129.104.AAA.BBB broadcast 129.104.AAA.255\\
                            netmask 255.255.255.0"\\
                            gateway="eth0/129.104.AAA.13"}

Tu fais le grand test en rechargeant ta configuration réseau par:

\cmdline{/etc/init.d/net.eth0 restart}

puis en pingant \fkz par exemple. Tu dois obtenir quelque chose comme:

\cmdline{root:~\# ping frankiz\\
PING frankiz (129.104.201.51) 56(84) bytes of data.\\
64 bytes from frankiz (129.104.201.51): icmp\_seq=1 ttl=63 time=0.364 ms\\
64 bytes from frankiz (129.104.201.51): icmp\_seq=2 ttl=63 time=0.269 ms}

Une dernière chose spécifique à Gentoo, pour pouvoir utiliser 'emerge' à travers le proxy de l'école: il faut exporter les variables d'environnement ci-dessous (éventuellement à mettre dans \file{/etc/profile}) :

\cmdline{export http\_proxy=http://kuzh.polytechnique.fr:8080\\
export ftp\_proxy=ftp://kuzh.polytechnique.fr:8080}

Et si tu n'utilises pas le miroir rsync du BR :

\cmdline{export SYNC=rsync://rsync/gentoo-portage}




\paragraph{Sous Debian}

Lors de l'installation d'une nouvelle Debian, le programme d'installation te propose logiquement de rentrer ces informations de manière interactive ; sinon, il est toujours possible de les modifier ainsi :

Le fichier \file{/etc/hostname} contient ton nom de machine. Tu peux éditer 
\file{/etc/hostname} avec ton éditeur préféré (vi ou vim, pico, voire emacs si tu aimes), mais la commande ci-dessous est suffisante:

\cmdline{echo 'ton\_pseudo' > /etc/hostname}


Le fichier \file{/etc/resolv.conf} décrit comment résoudre les noms DNS. La première ligne donne les suffixes à utiliser par défaut, et la seconde ligne indique les serveurs de noms, ceux qui associent le nom \url{frankiz} ou \url{ton\_pseudo} aux IP '129.104.201.51' ou 'ton\_ip' Le fichier contient donc :

\cmdline{search eleves.polytechnique.fr polytechnique.fr\\
nameserver 129.104.201.52 129.104.201.51}

Enfin,le fichier \file{/etc/network/interfaces} contient la description de la boucle locale (si tu veux faire du FTP vers toi-même par exemple :op), de l'interface réseau et les informations de routage. Il indique ton IP, ton sous réseau (ton étage), et la passerelle pour sortir de ton étage :

\cmdline{auto lo\\
iface lo inet loopback\\
\\
auto eth0\\
iface eth0 inet static\\
address 129.104.AAA.BBB\\
netmask 255.255.255.0\\
network 129.104.AAA.0\\
broadcast 129.104.AAA.255\\
gateway 129.104.AAA.13}

Tu fais le grand test en rechargeant ta configuration réseau par :

\cmdline{/etc/init.d/networking restart}

puis en pingant \fkz par exemple. Tu dois obtenir quelque chose comme:

\cmdline{root:~\# ping frankiz\\
PING frankiz (129.104.201.51) 56(84) bytes of data.\\
64 bytes from frankiz (129.104.201.51): icmp\_seq=1 ttl=63 time=0.364 ms\\
64 bytes from frankiz (129.104.201.51): icmp\_seq=2 ttl=63 time=0.269 ms}


Une dernière chose spécifique à Debian, pour pouvoir utiliser 'apt-get' et 'apt-cache' à travers le proxy de l'école, il faut rajouter la ligne ci-dessous dans \file{/etc/apt/apt.conf} :

\cmdline{Acquire::http::Proxy "http://kuzh.polytechnique.fr:8080";}

Attention, le apt.conf ne gère pas le protocole ftp via le proxy http.
Pour utiliser des ftp:// dans ton /etc/apt/sources.list, il faut rajouter  

\cmdline{ftp\_proxy = http://kuzh:8080}

dans les paramètres de wget (car apt utilise wget), \file{/etc/wgetrc} ou \file{/root/.wgetrc}. Tu peux aussi y mettre à ta guise:

\cmdline{http\_proxy = http://kuzh:8080}

Le BR maintient par ailleurs un miroir debian : tu peux l'utiliser en rajoutant à ton \file{/etc/sources.list}

\cmdline{deb ftp://miroir/debian [flavour] main contrib non-free}

où 'flavour' est la saveur de ta debian: stable, testing, unstable, experimental

\paragraph{Sous Redhat et Mandrake}

Il existe dans ces distributions une interface graphique pour configurer le réseau, bien qu'il soit possible, comme sur tout système linux, de le faire à la main à partir des fichiers de configuration dans \file{/etc/} , comme précédemment à quelques différences près.

Lance \app{DrakConf} en tant que root, puis l'outil de gestion du réseau.

Tu as autant de "eth0, eth1..." que de cartes réseau détectées. Sélectionne la carte sur laquelle est branché ton câble réseau, et lance l'Assistant. Utilise la détection automatique, puis sélectionne \menu{LAN connection} et continue. Tu dois maintenant fournir les paramètres nécessaires à ta connexion :

\begin{description}
	\item[Adresse IP] entre celle que tu as calculée : 129.104.AAA.BBB (cf. page \pageref{calcul_ip})
	\item[Masque de sous-réseau] 255.255.255.0
	\item[DHCP] laisse cette case décochée
\end{description}

Ensuite, tu dois encore entrer :
\begin{description}
	\item[Nom d'hôte] 'ton\_pseudo'.eleves.polytechnique.fr
	\item[Serveur DNS] 129.104.201.51
	\item[Passerelle] tu l'as aussi calculée : 129.104.AAA.13 (cf. page \pageref{calcul_ip})
\end{description}
 
Voilà, c'est bon !

\subsubsection{Configuration antivirus}

Elle est bonne celle là hein ?

\subsubsection{Configuration firewall}

La solution la plus simple pour se faire un firewall sous linux est d'utiliser les iptables. Pour ceci la première étape est d'installer le paquet iptables pour ta distribution. Ensuite, la configuration peut paraître délicate mais en fait ce ne sont que des règles simples, il suffit de comprendre le principe.

Configurer les iptables c'est définir une série de règles. Chaque règle a une forme simple, elle défini une action à effecter dans des conditions données. Ces conditions portent sur l'origine du paquet (l'unité élémentaire de ce qui circule sur le réseau), le format du paquet, le sens de circulation...

Un exemple de règle serait :

\cmdline{-A INPUT -i eth0 -s 129.104.201.51 -p tcp -m tcp --dport 80 -j ACCEPT}

Cette règle accepte les paquets que l'on reçoit de Frankiz (129.104.201.51) sur le port 80 qui utilisent le protocole TCP. Tout se lit clairement :
\begin{itemize}
	\item[-A] définit la chaine à filtrer. La chaine indique d'où provient la requête : INPUT pour un paquet entrant, OUTPUT pour un paquet sortant sont les principales.
	\item[-i] définit l'interface réseau... en gros la carte réseau (eth0 le plus souvent, mais il y a aussi lo pour la boucle locale - localhost).
	\item[-s] ip source du paquet à filtrer.
	\item[-d] ip destination du paquet à filtrer.
	\item[-p] protocole du paquet (tcp, udp, igmp, icmp sont les plus courants).
	\item[-m] définit un module particulier à utiliser pour filtrer plus précisemment. Le plus souvent on utilise les modules tcp, udp, multiport ou state.
	\item[--dport] port de destination du paquet (avec -m udp ou -m tcp)
	\item[--sport] port d'origine du paquet (avec -m udp ou -m tcp)
	\item[--state] défini l'état de la connexion (nécessite le module state). Les principales valeurs de test pour ce paramètre sont NEW (nouvelle connexion), ESTABLISHED (connexion déjà établie), RELATED (connexion dépendante d'une autre...)
	\item[-j] défini l'action à entreprendre (ACCEPT pour accepter le paquet, REJECT pour refuser le paquet et en informer l'emmeteur, DROP pour faire comme si le paquet n'existait pas, LOG pour loggeur la réception du paquet.
\end{itemize}

Tout ça c'est très bien mais tu n'as pas envie de te casser la tête à te faire un firewall tout seul (on te comprend :). Voici un petit firewall basique qui convient à la plupart des utilisations sur le réseau de l'X :

\cmdline{\# Comportement par défaut pour les différentes chaines\\
*filter\\
:INPUT DROP [0:0]\\
:FORWARD DROP [0:0]\\
:OUTPUT ACCEPT [0:0]\\
\\
\# Pour que tout se passe bien avec localhost\\
-A INPUT -i lo -j ACCEPT\\
\# Pour que les connexions sur les ports > 1024 soit autorisées\\
\# pour les programmes qui les utilisent comme connexion secondaire\\
\# (Exemple : serveur ftp)\\
-A INPUT -p tcp -m tcp --dport 1024:65535 -m state --state RELATED,ESTABLISHED -j ACCEPT\\
-A INPUT -p udp -m udp --dport 1024:65535 -m state --state RELATED,ESTABLISHED -j ACCEPT\\
\\
\# Pour ouvrir les ports des utilitaires standards :\\
\# 20,21:ftp, 22:ssh, 80:http, 119:news, 5050:qRezix\\
-A INPUT -p tcp -m multiport --dports 20,21,22,80,119,5050 -j ACCEPT\\
\# Pour profiter de la télé sur le réseau :\\
-A INPUT -p upd -m udp --dport 1234 -j ACCEPT\\
\\
\# Pour que les demande de connexion vers l'extérieur (impossible) ne ralentissent pas\\
-A OUTPUT -d ! 129.104.0.0/255.255.0.0 -j REJECT\\
\\
\# Pour pouvoir être 'pingable'\\
-A INPUT -p icmp -j ACCEPT\\
\\
\# Fin du fichier\\
COMMIT}

Pour activer ton firewall, tu n'as plus qu'à faire :

\cmdline{iptables-restore < le\_fichier\_ci\_dessus}

ou tu remplaces \texttt{le\_fichier\_ci\_dessus} par le nom sous lequel tu as sauvegardé ce fichier de configuration de firewall.


\subsubsection{Configuration navigateur web}

Le BR te conseille d'utiliser FireFox, qui est maintenant tout à fait opérationnel. Il est beaucoup plus stable que Konqueror --- le navigateur fourni par défaut avec KDE --- surtout sur les distributions réputées instables. bénéficie d'un pré-chargement pour démarrer plus vite. Par contre Konqueror bénéficie d'un pré-chargement pour démarrer plus vite.

\image{partie1-config_reseau/nux_proxy_firefox}{0.6}{Configuration du proxy sous FireFox}

Dans tous les cas, la seule configuration à mettre est celle du proxy. À l'adresse \url{http://frankiz/proxy.pac} se trouve un script de configuration automatique du proxy, écrit par le BR. Dans FireFox, il faut aller dans \menu{Edit}, \menu{Preferences} et dans l'onglet \menu{General} cliquer sur \menu{Connection Settings} ; ensuite tu coches la case \menu{Configuration automatique de proxy} et tu rentres cette URL.
 
\subsubsection{Configuration mail}
Le client mail le plus utilisé est kmail, mais il en existe d'autres... Mozilla / Mozilla-thunderbird le fait aussi par exemple.
Les serveurs sont:
Envoi du courrier: poly, pas de SSL (port par défaut, le 25)
Réception du courrier: poly, SSL. (Type de serveur: POP3; le port, par défaut, est le 995). Tu peux compléter le login et le password qui sont ton login/password poly, fournis par la DSI en ce début d'année.
Sous Knode, il faut aller dans l'onglet "Extras", et dans le cadre "Encryption" pour cocher uniquement la case "Use SSL".

\subsubsection{Configuration news}
Le client news le plus utilisé est knode, mais il en existe d'autres... Mozilla / Mozilla-thunderbird le fait aussi.
Sous Knode, c'est dans le menu "Configuration" ("settings"), puis "Configurer Knode".
Pour accéder aux fora de discussion des élèves, ici appelés par abus de langage "les br", il faudra choisir "frankiz" comme nom de serveur (le port est le port par défaut, le 119). De plus, les fora mondiaux "Usenet" sont accessibles via le serveur "polynews" de la DSI.
Tu peux y mettre ton identité/signature par défaut pour tous les serveurs auxquels tu t'abonneras (certains élèves hébergent aussi des fora de discussion privés ou non), et chaque serveur peut bénéficier d'une identité particulière, qui peut même être le résultat d'un programme ou d'un script (par exemple pour une signature aléatoire). Les signatures commencent généralement par:
--<espace><retour à la ligne>
De manière à ce que les "bons" clients news l'interprètent comme telle, la mettant par exemple en grisé et ainsi ils évitent de la recopier lorsque tu réponds à un message.
Dans l'onglet "Comptes" ou "Accounts", puis l'onglet "News", tu peux choisir le(s) serveur(s) que tu veux consulter.
Enfin, pour que Knode puisse envoyer des mails, il est bon aussi d'aller dans l'onglet "Comptes" et "Mail", et de mettre le serveur "poly" sur le port "25".
Il ne te reste plus qu'à t'inscrire sur des fora et à y participer! ... en respectant le binet idoine :)

Pour se connecter à un serveur de news en SSL  sous Knode (par exemple au serveur de polytechnique.org  ssl.polytechnique.org)
Sous Knode, il y a une petite subtilité puisqu'il ne gère pas le SSL.
Il faut installer "stunnel" pour mettre une redirection SSL de port ainsi:
Dans /etc/stunnel.conf ou /etc/stunnel/stunnel.conf (selon la distribution), mettre les lignes suivantes (les trois premières y sont en principe déjà):


\cmdline{\# location of pid file\\
pid = /etc/stunnel/stunnel.pid\\
\\
\# user to run as\\
setuid = stunnel\\
setgid = stunnel\\
\\
\# Use it for client mode\\
client = yes\\
\\
\# sample service-level configuration\\
\\
[nntps]\\
accept  = 119\\
connect = ssl.polytechnique.org:563\\
TIMEOUTclose = 0\\
}


Et tu peux lancer stunnel par « /etc/init.d/stunnel start »

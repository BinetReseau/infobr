%$Id$

\clearpage
\pagebreak
\bghdr{fond-nux}

\subsection{Configuration sous Linux}

\subsubsection{Configuration IP}
Quelle que soit ta distribution, il faut que tu décides d'un nom de machine --- ton pseudo en général. Tu as également besoin de connaître ton adresse IP. L'explication de comment la calculer se trouve page \pageref{calcul_ip} ; elle est notée dorénavant 129.104.AAA.BBB.

Bien sûr, l'ensemble des manipulations doit se faire en tant que root.

\paragraph{Sous Mandrake}

Il existe dans ces distributions une interface graphique pour configurer le réseau, bien qu'il soit possible, comme sur tout système linux, de le faire à la main à partir des fichiers de configuration dans \file{/etc/}.

Lance \app{DrakConf} en tant que root, puis l'outil de gestion du réseau.

Tu as autant de \texttt{eth0}, \texttt{eth1}\ldots que de cartes réseau détectées. Sélectionne la carte sur laquelle est branché ton câble réseau, et lance l'Assistant. Utilise la détection automatique, puis sélectionne \menu{LAN connection} et continue. Tu dois maintenant fournir les paramètres nécessaires à ta connexion :

\begin{description}
	\item[Adresse IP] entre celle que tu as calculée : 129.104.AAA.BBB (cf. page \pageref{calcul_ip})
	\item[Masque de sous-réseau] 255.255.255.0
	\item[DHCP] laisse cette case décochée
\end{description}

Ensuite, tu dois encore entrer :
\begin{description}
	\item[Nom d'hôte] 'ton\_pseudo'.eleves.polytechnique.fr
	\item[Serveur DNS] 129.104.201.51
	\item[Passerelle] tu l'as aussi calculée : 129.104.AAA.13 (cf. page \pageref{calcul_ip})
\end{description}
 
Voilà, c'est bon !

\paragraph{Sous Gentoo}

Si tu n'as jamais fait de configuration réseau sur ta Gentoo, il faudra certainement créer les fichiers qui suivent.

Le fichier \file{/etc/hostname} contient ton nom de machine. Tu peux éditer \file{/etc/hostname} avec ton éditeur préféré (\app{vi} ou \app{vim}, \app{pico}, voire \app{emacs} si tu aimes), mais la commande ci-dessous est suffisante :

\cmdline{echo 'ton\_pseudo' > /etc/hostname}

Le fichier \file{/etc/resolv.conf} décrit comment résoudre les noms DNS. La première ligne donne les suffixes à utiliser par défaut, et la seconde ligne indique les serveurs de noms, ceux qui associent le nom \server{frankiz} ou \server{ton\_pseudo} aux IP \server{129.104.201.51} ou \server{'ton\_ip'} Le fichier contient donc :

\cmdline{search eleves.polytechnique.fr polytechnique.fr\\
nameserver 129.104.201.52 129.104.201.51}

Enfin, le fichier \file{/etc/conf.d/net} contient la description de l'interface réseau et les informations de routage. Il indique ton IP, ton sous-réseau (ton étage), et la passerelle pour sortir de ton étage :

\cmdline{iface\_eth0="129.104.AAA.BBB broadcast 129.104.AAA.255\\
                            netmask 255.255.255.0"\\
                            gateway="eth0/129.104.AAA.13"}

Tu fais le grand test en rechargeant ta configuration réseau par :

\cmdline{/etc/init.d/net.eth0 restart}

puis en pingant \fkz par exemple. Tu dois obtenir quelque chose comme :

\cmdline{root:~\# ping frankiz\\
PING frankiz (129.104.201.51) 56(84) bytes of data.\\
64 bytes from frankiz (129.104.201.51): icmp\_seq=1 ttl=63 time=0.364 ms\\
64 bytes from frankiz (129.104.201.51): icmp\_seq=2 ttl=63 time=0.269 ms}

Pour pouvoir utiliser emerge à travers le proxy de l'école, il faut définir les variables d'environnement ci-dessous dans le fichier \file{/etc/make.conf} :

\cmdline{http\_proxy=http://kuzh.polytechnique.fr:8080\\
GENTOO\_MIRRORS="ftp://miroir/gentoo http://gentoo.osuosl.org/"\\
SYNC="rsync://rsync/gentoo-portage"}

Tu peux évidemment ajouter d'autres miroirs (séparés par des espaces) dans ta liste mais \url{ftp://miroir} étant interne, il sera toujours beaucoup plus rapide que les autres. On te conseille ici \url{http://gentoo.osuosl.org/} qui est un miroir très complet mais très lent.

\paragraph{Sous Debian}

Lors de l'installation d'une nouvelle Debian, le programme d'installation te propose logiquement de rentrer ces informations de manière interactive ; sinon, il est toujours possible de les modifier ainsi :

Le fichier \file{/etc/hostname} contient ton nom de machine. De même que sous Gentoo, tu peux l'éditer  avec ton éditeur préféré ou utiliser la commande :

\cmdline{echo 'ton\_pseudo' > /etc/hostname}

Comme sous Gentoo, le fichier \file{/etc/resolv.conf} décrit comment résoudre les noms DNS, il doit contenir :

\cmdline{search eleves.polytechnique.fr polytechnique.fr\\
nameserver 129.104.201.52 129.104.201.51}

Enfin,le fichier \file{/etc/network/interfaces} contient la description de la boucle locale (si tu veux faire du FTP vers toi-même par exemple :) ), de l'interface réseau et les informations de routage. Il indique ton IP, ton sous-réseau (ton étage), et la passerelle pour sortir de ton étage :

\cmdline{auto lo\\
iface lo inet loopback\\
\\
auto eth0\\
iface eth0 inet static\\
address 129.104.AAA.BBB\\
netmask 255.255.255.0\\
network 129.104.AAA.0\\
broadcast 129.104.AAA.255\\
gateway 129.104.AAA.13}

Toujours comme sous Gentoo, recharge ta configuration réseau par :

\cmdline{/etc/init.d/networking restart}

puis essaye de pinger \fkz par exemple. Tu dois obtenir quelque chose comme:

\cmdline{root:~\# ping frankiz\\
PING frankiz (129.104.201.51) 56(84) bytes of data.\\
64 bytes from frankiz (129.104.201.51): icmp\_seq=1 ttl=63 time=0.364 ms\\
64 bytes from frankiz (129.104.201.51): icmp\_seq=2 ttl=63 time=0.269 ms}

Une dernière chose spécifique à Debian, pour pouvoir utiliser 'apt-get' et 'apt-cache' à travers le proxy de l'école, il faut rajouter la ligne ci-dessous dans \file{/etc/apt/apt.conf} :

\cmdline{Acquire::http::Proxy "http://kuzh.polytechnique.fr:8080";}

Attention, le \file{apt.conf} ne gère pas le protocole ftp via le proxy http.
Pour utiliser des \url{ftp:// }dans ton \file{/etc/apt/sources.list}, il faut rajouter :

\cmdline{ftp\_proxy = http://kuzh:8080}

dans les paramètres de wget (car apt utilise wget), \file{/etc/wgetrc} ou \file{/root/.wgetrc}. Tu peux aussi y mettre à ta guise:

\cmdline{http\_proxy = http://kuzh:8080}

Le BR maintient par ailleurs un miroir debian : tu peux l'utiliser en rajoutant à ton \file{/etc/sources.list}

\cmdline{deb ftp://miroir/debian [flavour] main contrib non-free\\
deb ftp://miroir/debian-non-US [flavour] main contrib non-free\\
deb ftp://miroir/debian-security [flavour] main contrib non-free\\
deb ftp://miroir/debian-marillat [flavour] main}

où '[flavour]' est la saveur de ta debian: stable, testing, unstable, experimental

\subsubsection{Configuration antivirus}

Elle est drôle celle-là hein ?

\subsubsection{Configuration firewall}

La solution la plus simple pour se faire un firewall sous linux est d'utiliser les iptables. Pour ceci la première étape est d'installer le paquet iptables pour ta distribution. Ensuite, la configuration peut paraître délicate mais en fait ce ne sont que des règles simples, il suffit de comprendre le principe.

Configurer les iptables c'est définir une série de règles. Chaque règle a une forme simple, elle défini une action à effecter dans des conditions données. Ces conditions portent sur l'origine du paquet (l'unité élémentaire de ce qui circule sur le réseau), le format du paquet, le sens de circulation...

Un exemple de règle serait :

\cmdline{-A INPUT -i eth0 -s 129.104.201.51 -p tcp -m tcp --dport 80 -j ACCEPT}

Cette règle accepte les paquets que l'on reçoit de \fkz (129.104.201.51) sur le port 80 qui utilisent le protocole TCP. Tout se lit clairement :
\begin{itemize}
	\item[\texttt{-A}] définit la chaine à filtrer. La chaine indique d'où provient la requête : INPUT pour un paquet entrant, OUTPUT pour un paquet sortant sont les principales.
	\item[\texttt{-i}] définit l'interface réseau... en gros la carte réseau (eth0 le plus souvent, mais il y a aussi lo pour la boucle locale - localhost).
	\item[\texttt{-s}] ip source du paquet à filtrer.
	\item[\texttt{-d}] ip destination du paquet à filtrer.
	\item[\texttt{-p}] protocole du paquet (tcp, udp, igmp, icmp sont les plus courants).
	\item[\texttt{-m}] définit un module particulier à utiliser pour filtrer plus précisemment. Le plus souvent on utilise les modules tcp, udp, multiport ou state.
	\item[\texttt{-{}-dport}] port de destination du paquet (avec -m udp ou -m tcp)
	\item[\texttt{-{}-sport}] port d'origine du paquet (avec -m udp ou -m tcp)
	\item[\texttt{-{}-state}] définit l'état de la connexion (nécessite le module state). Les principales valeurs de test pour ce paramètre sont NEW (nouvelle connexion), ESTABLISHED (connexion déjà établie), RELATED (connexion dépendante d'une autre...)
	\item[\texttt{-j}] défini l'action à entreprendre (ACCEPT pour accepter le paquet, REJECT pour refuser le paquet et en informer l'emmeteur, DROP pour faire comme si le paquet n'existait pas, LOG pour logguer la réception du paquet.
\end{itemize}

Tout ça c'est très bien mais tu n'as pas envie de te casser la tête à te faire un firewall tout seul (on te comprend :). Voici un petit firewall basique pour le réseau de l'X :

\cmdline{\# Comportement par défaut pour les différentes chaines\\
*filter\\
:INPUT DROP [0:0]\\
:FORWARD DROP [0:0]\\
:OUTPUT ACCEPT [0:0]\\
\\
\# Pour que tout se passe bien avec localhost\\
-A INPUT -i lo -j ACCEPT\\
\# Pour que les connexions sur les ports > 1024 soit autorisées\\
\# pour les programmes qui les utilisent comme connexion secondaire\\
\# (Exemple : serveur ftp)\\
-A INPUT -p tcp -m tcp -{}-dport 1024:65535 -m state $\backslash$ \\
 -{}-state RELATED,ESTABLISHED -j ACCEPT\\
-A INPUT -p udp -m udp -{}-dport 1024:65535 -m state $\backslash$ \\
 -{}-state RELATED,ESTABLISHED -j ACCEPT\\
\\
\# Pour ouvrir les ports des utilitaires standards :\\
\# 20,21:ftp, 22:ssh, 80:http, 119:news, 5050:qRezix, 5054:Xplo\\
-A INPUT -p tcp -m multiport $\backslash$ \\
 -{}-dports 20,21,22,80,119,5050,5054 -j ACCEPT\\
\# Pour profiter de la télé sur le réseau :\\
-A INPUT -p upd -m udp -{}-dport 1234 -j ACCEPT\\
\\
\# Pour que les demande de connexion vers l'extérieur (impossible) ne ralentissent pas\\
-A OUTPUT -d ! 129.104.0.0/255.255.0.0 -j REJECT\\
\\
\# Pour pouvoir être 'pingable'\\
-A INPUT -p icmp -j ACCEPT\\
\\
\# Fin du fichier\\
COMMIT
}

Pour activer ton firewall, tu n'as plus qu'à faire :

\cmdline{iptables-restore < le\_fichier\_ci\_dessus}

en remplaçant \texttt{le\_fichier\_ci\_dessus} par le nom sous lequel tu as sauvegardé ce fichier de configuration de firewall.


\subsubsection{Configuration navigateur web}

\image{partie1-config_reseau/nux_proxy_firefox}{0.66}{Configuration du proxy sous Firefox}

\flimage{partie1-config_reseau/nux_firefox_icon}{0.12}{l}
Le BR te conseille d'utiliser \app{Firefox}, qui est maintenant tout à fait opérationnel. Il est beaucoup plus stable que \app{Konqueror} --- le navigateur fourni par défaut avec KDE --- surtout sur les distributions réputées instables. Dans tous les cas, la seule configuration à mettre est celle du proxy. À l'adresse \url{http://frankiz/proxy.pac} se trouve un script de configuration automatique du proxy, écrit par le BR. Dans \app{Firefox}, il faut aller dans \menu{Edit}, \menu{Preferences} et dans l'onglet \menu{General} cliquer sur \menu{Connection Settings} ; ensuite tu coches la case \menu{Configuration automatique de proxy} et tu rentres cette URL.
 
 
\subsubsection{Configuration mail}

\flimage{partie1-config_reseau/nux_kmail_icon}{0.12}{l}
Le client mail le plus utilisé est \app{Kmail}, mais il en existe bien sûr d'autres comme \app{Thunderbird}.

Va dans \menu{Configuration}, \menu{Configurer Kmail}. Choisis la rubrique \menu{Réseau}. Commence par créer un nouveau compte dans l'onglet \menu{Réception des messages} en cliquant sur le bouton \menu{Ajouter...} et choisis le type POP3.

\image{partie1-config_reseau/nux_config_kmail_pop}{0.66}{Configuration de la réception des messages sous Kmail}

Utilise les paramètres suivants pour configurer l'onglet \menu{Général} :
\begin{description}
  \item[Nom] le nom du compte, par exemple : Mails Poly
  \item[Utilisateur] rentre le login \server{poly} que t'a fourni la DSI à ton arrivée sur le plateau
  \item[Mot de passe] idem
  \item[Serveur] \server{poly.polytechnique.fr}
  \item[Port] 995
\end{description}

Ensuite, va dans l'onglet \menu{Extras} et coche la case \menu{Utiliser SSL pour sécuriser les téléchargements}.

\image{partie1-config_reseau/nux_config_kmail_smtp}{0.66}{Configuration de l'envoi des messages sous Kmail}

Maintenant, dans l'onglet \menu{Envoi des messages} clique sur le bouton \menu{Ajouter...}. Utilise les paramètres suivants pour le configurer :
\begin{description}
  \item[Nom] le même nom de compte que précédemment
  \item[Serveur] \server{poly.polytechnique.fr}
  \item[Port] 25
\end{description}
Sinon, laisse toutes les cases décochées.


\subsubsection{Configuration news}

\flimage{partie1-config_reseau/nux_knode_icon}{0.12}{l}
Le client news le plus utilisé est \app{Knode}. Parmi les autres clients news, citons \app{Thunderbird} ou \app{slrn}.

\image{partie1-config_reseau/nux_config_knode}{0.7}{Configuration de Knode}

Sous \app{Knode}, c'est dans le menu \menu{Configuration}, puis \menu{Configurer Knode}. Va dans la rubrique \menu{Comptes, Forums de discussion} et crée un compte en cliquant sur \menu{Nouveau...}.

Remplis l'onglet \menu{Serveur} avec les informations suivantes :
\begin{description}
  \item[Nom] ce que tu veux pour décrire ce compte, par exemple News Frankiz
  \item[Serveur] \server{frankiz.polytechnique.fr}
  \item[Port] 119
\end{description}

Ensuite occupe-toi de l'onglet \menu{Identité} :
\begin{description}
  \item[Nom] mets ton pseudo dans ce champ
  \item[Organisation] X, École Polytechnique, comme tu le sens
  \item[Adresse électronique] ton adresse mail, pour que les gens puissent te répondre par mail.
\end{description}

Enfin, pour que \app{Knode} puisse envoyer des mails, il faut aller dans la rubrique \menu{Comptes}, sous-rubrique \menu{Courrier électronique}, et choisir comme serveur d'envoi de mails \server{poly.polytechnique.fr}, port 25 --- c'est exactement la même configuration SMTP que \app{Kmail}.

Si tu veux mettre une signature à la fin des messages que tu posteras, il te suffit de la mettre dans l'onglet Identité. Sur la plupart des clients la signature est interprétée comme extérieure au message et n'est en particuliers pas incluse dans le texte cité lorsque tu réponds à un message. Pour définir une signature à la main, il suffit de mettre \verb*+-- +\ (c'est à dire -{}-<espace>) sur une ligne, et tout ce qui suivra cette ligne composera ta signature.

Il ne te reste plus qu'à t'inscrire à des newsgroups (reporte toi à la page \pageref{newsgroups} pour plus d'infos) et à poster !

Pour te connecter aux serveur news de Polytechnique.org, qui a un accès sécurisé, avec \app{Knode}, il y a une petite subtilité car il ne gère pas le SSL. Il faut installer "stunnel" quit permet de définir une redirection SSL de port. Dans \file{/etc/stunnel.conf} ou \file{/etc/stunnel/stunnel.conf} selon ta distribution, mets les lignes suivantes (les trois premières y sont en principe déjà) :

\cmdline{\# location of pid file\\
pid = /etc/stunnel/stunnel.pid\\
\\
\# user to run as\\
setuid = stunnel\\
setgid = stunnel\\
\\
\# Use it for client mode\\
client = yes\\
\\
\# sample service-level configuration\\
\\
{[}nntps{]}\\
accept  = 1119\\
connect = ssl.polytechnique.org:563\\
TIMEOUTclose = 0\\
}

Il ne te reste plus qu'à lancer stunnel par :

\cmdline{/etc/init.d/stunnel start}

Et tu peux ainsi lire les news de polytechnique.org en mettant \server{localhost} comme serveur et \server{1119} comme port. Il faut aussi que tu coche 'Le serveur exige une identification' et que tu rentres ton nom d'utilisateur à Polytechnique.org et ton mot de passe que tu peux définir sur \url{http://www.polytechnique.org/acces\_smtp.php}.

\vfill
